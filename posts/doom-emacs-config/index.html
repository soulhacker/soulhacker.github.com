<!doctype html>

<html lang="en-us">

<head>
  <title>Doom Emacs 配置 - Paradigm X</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="The HTML5 Herald" />
<meta name="author" content="[Neo Lee]" /><meta property="og:url" content="/posts/doom-emacs-config/">
  <meta property="og:site_name" content="Paradigm X">
  <meta property="og:title" content="Doom Emacs 配置">
  <meta property="og:description" content="这份配置基于 Emacs 模式的按键组合，没有启用 Doom Emacs 缺省的 evil 模式，如果希望使用类 Vim 的按键方式，可以参考其他一些大牛，比如的 Tec Osaur 的非常有教益的版本。">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-09-18T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-01T17:40:29+08:00">
    <meta property="article:tag" content="Tools">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Doom Emacs 配置">
  <meta name="twitter:description" content="这份配置基于 Emacs 模式的按键组合，没有启用 Doom Emacs 缺省的 evil 模式，如果希望使用类 Vim 的按键方式，可以参考其他一些大牛，比如的 Tec Osaur 的非常有教益的版本。">

<meta name="generator" content="Hugo 0.148.1">
    

  <link rel="stylesheet" href="/css/normalize.min.css" />
  <link rel="stylesheet" href="/fontawesome/css/all.min.css" />
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  
  
  <link rel="stylesheet" type="text/css" href="/css/styles.css" /><link rel='stylesheet' href='/css/main.css'><link rel='stylesheet' href='/css/syntax.css'>
</head>

<body>
  <div id="container">
    <header>
      
      <h1>
        <a href="/">Paradigm X</a>
      </h1>

      <ul id="social-media">
      </ul>
      
      <p><em>Vision quests of a soulhacker</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="active" href="/posts/">
                <i class="fa-li fa  fa-lg"></i><span>全部文章</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/tags/">
                <i class="fa-li fa  fa-lg"></i><span>标签</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/about/">
                <i class="fa-li fa  fa-lg"></i><span>关于</span>
            </a>
        </li>
        
    </ul>
</nav>


    <main>




<article>

    <h1>Doom Emacs 配置</h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2022-09-18T00:00:00Z">Sep 18, 2022</time>
        </li>
        
        <li>
            Modified on <time datetime="2025-07-01T17:40:29&#43;08:00">Jul 1, 2025</time>
        </li>
        
        

        
        <li>
            <em>
                
                    
                    <a href="/tags/tools">#Tools</a>
                
            </em>
        </li>
        

        <li>16 minute read</li>
    </ul>
</aside>

    

    
      

    

    <blockquote>
<p>这份配置基于 Emacs 模式的按键组合，没有启用 Doom Emacs 缺省的 <code>evil</code> 模式，如果希望使用类 Vim 的按键方式，可以参考其他一些大牛，比如的 <a href="https://tecosaur.github.io/emacs-config/config.html">Tec Osaur</a> 的非常有教益的版本。</p></blockquote>
<h2 id="前言">前言</h2>
<p>Doom Emacs 的配置都在变量 <code>doom-user-dir</code> 指向的目录下（根据安装时的选择可能是 <code>~/.doom.d/</code> 或 <code>~/.config/doom/</code> ），主要是三个文件：</p>
<ul>
<li><code>init.el</code> ：启用/停用 Doom 预先配置好的模块（ <em>modules</em> ）；</li>
<li><code>package.el</code> ：自己另行下载安装的软件包（ <em>packages</em> ），或对已启用的软件包版本进行配置，Doom Emacs 使用 <code>straight.el</code> 包管理器 <a href="https://github.com/radian-software/straight.el">→</a>；</li>
<li><code>config.el</code> ：各种配置，大部分预制模块不需要或者只需要少许配置，因为 Doom 已经做了相对好的缺省安排，自行安装的包则需要做相应的配置；当然如果对 Doom 提供的缺省安排不满意，也可以在此动手覆盖。</li>
</ul>
<p>要更改配置就编辑这三个文件即可，但我们有更好的选择，那就是 <em>literate config</em> ，这是个很酷的功能 <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>，我们把所有配置代码都用 <code>org-babel</code> 的源码块（ <em>source block</em> ）写在这个 <code>config.org</code> 文件中（对，你现在看到的就是这个文件本身），然后用 <code>org-babel</code> 提供的 <code>org-babel-tangle-file</code> 函数来自动生成上述三个文件。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">emacs --batch --eval <span class="s2">&#34;(progn (require &#39;org) (setq org-confirm-babel-evaluate nil) (org-babel-tangle-file \&#34;~/.config/doom/config.org\&#34;))&#34;</span>
</span></span></code></pre></div><p>这个 <em>bootstrap</em> 过程只需要做一次，之后 Doom 提供的 <code>literate</code> 模块会自动维护。</p>
<p>无论通过什么方式，配置文件变化后要使用 <code>doom sync</code> 命令来更新环境（这个命令首先会自动从本文件出发重新构造新的配置文件），还可以用 <code>doom doctor</code> 来检查配置中可能存在的问题（最常见的问题是依赖的外部程序找不到或者没配好）；Doom Emacs 更新比较频繁，而且鼓励用户滚动更新紧跟开发分支，所以可以定期用 <code>doom upgrade</code> 来更新 Doom Emacs 本身及所有启用的包。</p>
<p>本着不折腾的原则，我对功能实现方案总的选择标准是：</p>
<ul>
<li>能用预制模块的尽量用；</li>
<li>能用缺省配置的尽量用；</li>
<li>重视持续维护和移植的代价；</li>
<li>还是不喜欢 <code>evil</code> 。</li>
</ul>
<h2 id="预制模块">预制模块</h2>
<p>Doom 提供的大量预制模块大多是当前优选，难以确定的地方也提供了主流方案多选一，并进行了比较恰当的配置，是宝藏，我的配置主要以这些预制模块为主。</p>
<p>如果不清楚某个模块效果到底如何，可以启用试试；<a href="https://docs.doomemacs.org/latest/#/modules">官方文档</a>虽然还不完整，但已经挺有用了，可以了解每个模块的基本配置项、依赖和一些常见问题，千万不要错过。</p>
<p><a id="code-snippet--init.el"></a></p>
<div class="highlight" collapsed="t"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;; init.el -*- lexical-binding: t; -*-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">doom!</span> <span class="nb">:input</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-input&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:completion</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-completion&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:ui</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-ui&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:editor</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-editor&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:emacs</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-emacs&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:term</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-term&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:checkers</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-checkers&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:tools</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-tools&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:os</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-os&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:lang</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-lang&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:email</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-email&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:app</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-app&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-config&gt;&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="p">)</span>
</span></span></code></pre></div><h3 id="基本设置">基本设置</h3>
<p>Doom 的 <code>:config</code> 缺省配置大多很好，少数需要定制的后面再说；另外很重要的是启用 <code>literate</code> 模块。</p>
<p><a id="code-snippet--doom-config"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="nv">literate</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">default</span> <span class="nv">+bindings</span> <span class="nv">+smartparens</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="用户界面">用户界面</h3>
<p>这部分包含了 Doom 的 <code>:completion</code> <code>:ui</code> <code>:editor</code> <code>:emacs</code> <code>:term</code> <code>:checkers</code> <code>:tools</code> <code>:os</code> 几大类别。</p>
<p>无处不在的自动补全功能，目前最简单好用的还是 <code>company</code> 搭配 <code>vertico</code> 。</p>
<p><a id="code-snippet--doom-completion"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">company</span> <span class="nv">+childframe</span> <span class="nv">+icons</span><span class="p">)</span><span class="c1">; the ultimate code completion backend</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(corfu +orderless +dabbrev +icons)</span>
</span></span><span class="line"><span class="cl">                            <span class="c1">; complete with cap(f), cape and a flying feather!</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;helm                      ; the *other* search engine for love and life</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;ido                       ; the other *other* search engine...</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;ivy                       ; a search engine for love and life</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">vertico</span> <span class="nv">+childframe</span> <span class="nv">+icons</span><span class="p">)</span><span class="c1">; the search engine of the future</span>
</span></span></code></pre></div><p>这里面有偏视觉和娱乐的（前者如 <code>hl-todo</code> <code>ligatures</code> 后者如 <code>doom-quit</code> ），但大多数是很实用的，比如 <code>window-select</code> 大幅强化了多窗口时切换窗口 <code>C-x o</code> 的体验（实际使用的是 <code>ace-window</code> ）。另外 <code>unicode</code> 这个非常重要，如果不打开会有很多中文显示方面的问题。</p>
<p><a id="code-snippet--doom-ui"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;deft                      ; notational velocity for Emacs</span>
</span></span><span class="line"><span class="cl"><span class="nv">doom</span>                        <span class="c1">; what makes DOOM look the way it does</span>
</span></span><span class="line"><span class="cl"><span class="nv">doom-dashboard</span>              <span class="c1">; a nifty splash screen for Emacs</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;doom-quit                 ; DOOM quit-message prompts when you quit Emacs</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">emoji</span> <span class="nv">+unicode</span> <span class="nv">+github</span><span class="p">)</span>    <span class="c1">; 🙂</span>
</span></span><span class="line"><span class="cl"><span class="nv">hl-todo</span>                     <span class="c1">; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;hydra</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;indent-guides             ; highlighted indent columns</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">ligatures</span> <span class="nv">+extra</span><span class="p">)</span>          <span class="c1">; ligatures and symbols to make your code pretty again</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;minimap                   ; show a map of the code on the side</span>
</span></span><span class="line"><span class="cl"><span class="nv">modeline</span>                    <span class="c1">; snazzy, Atom-inspired modeline, plus API</span>
</span></span><span class="line"><span class="cl"><span class="nv">nav-flash</span>                   <span class="c1">; blink cursor line after big motions</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;neotree                   ; a project drawer, like NERDTree for vim</span>
</span></span><span class="line"><span class="cl"><span class="nv">ophints</span>                     <span class="c1">; highlight the region an operation acts on</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">popup</span> <span class="nv">+all</span> <span class="nv">+defaults</span><span class="p">)</span>      <span class="c1">; tame sudden yet inevitable temporary windows</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;tabs                      ; a tab bar for Emacs</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">treemacs</span> <span class="nv">+lsp</span><span class="p">)</span>             <span class="c1">; a project drawer, like neotree but cooler</span>
</span></span><span class="line"><span class="cl"><span class="nv">unicode</span>                     <span class="c1">; extended unicode support for various languages</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">vc-gutter</span> <span class="nv">+pretty</span><span class="p">)</span>         <span class="c1">; vcs diff in the fringe</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;vi-tilde-fringe           ; fringe tildes to mark beyond EOB</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">window-select</span> <span class="nv">+number</span><span class="p">)</span>     <span class="c1">; visually switch windows</span>
</span></span><span class="line"><span class="cl"><span class="nv">workspaces</span>                  <span class="c1">; tab emulation, persistence &amp; separate workspaces</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;zen                       ; distraction-free coding or writing</span>
</span></span></code></pre></div><p>编辑相关的模块这里，我做的最大选择是不用 <code>evil</code> ，当然很多 Spacemacs 和 Doom 用户都会选择这个模式。这里要特别提一下的是 <code>lipsy</code> ，这是针对 Lisp 类语言的一个编辑模式，非常巧妙的实现了单按键的光标快速移动和编辑操作，但不需要切 Vim 模式，我认为比传统的 <code>paredit</code> 和 <code>smartparens</code> 都更高明。</p>
<p><a id="code-snippet--doom-editor"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;(evil +everywhere)        ; come to the dark side, we have cookies</span>
</span></span><span class="line"><span class="cl"><span class="nv">file-templates</span>              <span class="c1">; auto-snippets for empty files</span>
</span></span><span class="line"><span class="cl"><span class="nv">fold</span>                        <span class="c1">; (nigh) universal code folding</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(format +onsave)          ; automated prettiness</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;god                       ; run Emacs commands without modifier keys</span>
</span></span><span class="line"><span class="cl"><span class="nv">lispy</span>                       <span class="c1">; vim for lisp, for people who don&#39;t like vim</span>
</span></span><span class="line"><span class="cl"><span class="nv">multiple-cursors</span>            <span class="c1">; editing in many places at once</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;objed                     ; text object editing for the innocent</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;parinfer                  ; turn lisp into python, sort of</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;rotate-text               ; cycle region at point between text candidates</span>
</span></span><span class="line"><span class="cl"><span class="nv">snippets</span>                    <span class="c1">; my elves. They type so I don&#39;t have to</span>
</span></span><span class="line"><span class="cl"><span class="nv">word-wrap</span>                   <span class="c1">; soft wrapping with language-aware indent</span>
</span></span></code></pre></div><p>一些 Emacs 常规功能，基本都开启就行了。</p>
<p><a id="code-snippet--doom-emacs"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">dired</span> <span class="nv">+dirvish</span> <span class="nv">+icons</span><span class="p">)</span>     <span class="c1">; making dired pretty [functional]</span>
</span></span><span class="line"><span class="cl"><span class="nv">electric</span>                    <span class="c1">; smarter, keyword-based electric-indent</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">ibuffer</span> <span class="nv">+icons</span><span class="p">)</span>            <span class="c1">; interactive buffer management</span>
</span></span><span class="line"><span class="cl"><span class="nv">undo</span>                        <span class="c1">; persistent, smarter undo for your inevitable mistakes</span>
</span></span><span class="line"><span class="cl"><span class="nv">vc</span>                          <span class="c1">; version-control and Emacs, sitting in a tree</span>
</span></span></code></pre></div><p>Doom 支持几种内置的终端模拟器，效果最好的应该是 <code>vterm</code> 。</p>
<p><a id="code-snippet--doom-term"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;eshell                    ; the elisp shell that works everywhere</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;shell                     ; simple shell REPL for Emacs</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;term                      ; basic terminal emulator for Emacs</span>
</span></span><span class="line"><span class="cl"><span class="nv">vterm</span>                       <span class="c1">; the best terminal emulation in Emacs</span>
</span></span></code></pre></div><p>关于拼写检查，我试了各种组合，目前最好的应该还是 <code>flyspell</code> 和 <code>aspell</code> 。</p>
<p><a id="code-snippet--doom-checkers"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">syntax</span> <span class="nv">+childframe</span><span class="p">)</span>        <span class="c1">; tasing you for every semicolon you forget</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">spell</span> <span class="nv">+aspell</span> <span class="nv">+flyspell</span><span class="p">)</span>   <span class="c1">; tasing you for misspelling mispelling</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;grammar                   ; tasing grammar mistake every you make</span>
</span></span></code></pre></div><p>这一组工具我基本都是缺省选择，值得一提的是 <code>magit</code> 真棒，用起来简直上瘾，连写 <em>commit message</em> 都变得香甜了。注意 <code>lsp</code> 要打开，后面配置很多编程语言时会用到。</p>
<p><a id="code-snippet--doom-tools"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;ansible</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;biblio                    ; Writes a PhD for you (citation needed)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;collab                    ; buffers with friends</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">debugger</span> <span class="nv">+lsp</span><span class="p">)</span>             <span class="c1">; FIXME stepping through code, to help you add bugs</span>
</span></span><span class="line"><span class="cl"><span class="nv">direnv</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;docker</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;editorconfig              ; let someone else argue about tabs vs spaces</span>
</span></span><span class="line"><span class="cl"><span class="nv">ein</span>                         <span class="c1">; tame Jupyter notebooks with emacs</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">eval</span> <span class="nv">+overlay</span><span class="p">)</span>             <span class="c1">; run code, run (also, repls)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">lookup</span> <span class="nv">+dictionary</span><span class="p">)</span>        <span class="c1">; navigate your code and its documentation</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">lsp</span> <span class="nv">+peek</span><span class="p">)</span>                 <span class="c1">; M-x vscode</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">magit</span> <span class="nv">+forge</span><span class="p">)</span>              <span class="c1">; a git porcelain for Emacs</span>
</span></span><span class="line"><span class="cl"><span class="nv">make</span>                        <span class="c1">; run make tasks from Emacs</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;pass                      ; password manager for nerds</span>
</span></span><span class="line"><span class="cl"><span class="nv">pdf</span>                         <span class="c1">; pdf enhancements</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;prodigy                   ; FIXME managing external services &amp; code builders</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;taskrunner                ; taskrunner for all your projects</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;terraform                 ; infrastructure as code</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;tmux                      ; an API for interacting with tmux</span>
</span></span><span class="line"><span class="cl"><span class="nv">tree-sitter</span>                 <span class="c1">; syntax and parsing, sitting in a tree...</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;upload                    ; map local to remote projects via ssh/ftp</span>
</span></span></code></pre></div><p>这两个都是与操作系统有关的补丁，前一个 Mac 用户启用，后一个则都应该启用。</p>
<p><a id="code-snippet--doom-os"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">:if</span> <span class="nv">IS-MAC</span> <span class="nv">macos</span><span class="p">)</span>          <span class="c1">; improve compatibility with macOS</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">tty</span> <span class="nv">+osc</span><span class="p">)</span>                  <span class="c1">; improve the terminal Emacs experience</span>
</span></span></code></pre></div><h3 id="编程语言">编程语言</h3>
<p>Doom 提供了几乎所有主流语言的预制模块，大部分都提供了对 LSP 的支持，有些 <em>language server</em> 可以直接在 Emacs 中下载配置，但有些需要另外安装配置。有不少 <em>language server</em> 实现不太好，所以需要自己判断，下面是我启用的一些用得到的语言，大部分都启用了 LSP，可以用 <code>doom doctor</code> 来确认需要另外配置的外部支持软件。另一个值得尝试的选项是 <code>+tree-sitter</code> ，一个强大的静态代码分析插件，官方文档中没有，但实际上存在。另外，无论你主要用什么编程语言， <code>emacs-lisp</code> 和 <code>org</code> 这俩都应该启用，否则还用什么 Emacs 啊！</p>
<p><a id="code-snippet--doom-lang"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;agda                      ; types of types of types of types...</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;beancount                 ; mind the GAAP</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(cc +lsp)                 ; C &gt; C++ == 1</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">clojure</span> <span class="nv">+lsp</span><span class="p">)</span>              <span class="c1">; java with a lisp</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;common-lisp               ; if you&#39;ve seen one lisp, you&#39;ve seen them all</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;coq                       ; proofs-as-programs</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;crystal                   ; ruby at the speed of c</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;csharp                    ; unity, .NET, and mono shenanigans</span>
</span></span><span class="line"><span class="cl"><span class="nv">data</span>                        <span class="c1">; config/data formats</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(dart +flutter)           ; paint ui and not much else</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;dhall</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;elixir                    ; erlang done right</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;elm                       ; care for a cup of TEA?</span>
</span></span><span class="line"><span class="cl"><span class="nv">emacs-lisp</span>                  <span class="c1">; drown in parentheses</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;erlang                    ; an elegant language for a more civilized age</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;ess                       ; emacs speaks statistics</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;factor</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;faust                     ; dsp, but you get to keep your soul</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;fortran                   ; in FORTRAN, GOD is REAL (unless declared INTEGER)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;fsharp                    ; ML stands for Microsoft&#39;s Language</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;fstar                     ; (dependent) types and (monadic) effects and Z3</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;gdscript                  ; the language you waited for</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">go</span> <span class="nv">+lsp</span><span class="p">)</span>                   <span class="c1">; the hipster dialect</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(graphql +lsp)            ; Give queries a REST</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">haskell</span> <span class="nv">+lsp</span> <span class="nv">+tree-sitter</span><span class="p">)</span> <span class="c1">; a language that&#39;s lazier than I am</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;hy                        ; readability of scheme w/ speed of python</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;idris                     ; a language you can depend on</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">json</span> <span class="nv">+lsp</span> <span class="nv">+tree-sitter</span><span class="p">)</span>    <span class="c1">; At least it ain&#39;t XML</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">java</span> <span class="nv">+lsp</span><span class="p">)</span>                 <span class="c1">; the poster child for carpal tunnel syndrome</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">javascript</span> <span class="nv">+lsp</span><span class="p">)</span>           <span class="c1">; all(hope(abandon(ye(who(enter(here))))))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;julia                     ; a better, faster MATLAB</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;kotlin                    ; a better, slicker Java(Script)</span>
</span></span><span class="line"><span class="cl"><span class="nv">latex</span>                       <span class="c1">; writing papers in Emacs has never been so fun</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;lean                      ; for folks with too much to prove</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;ledger                    ; be audit you can be</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;lua                       ; one-based indices? one-based indices</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">markdown</span> <span class="nv">+grip</span><span class="p">)</span>            <span class="c1">; writing docs for people to ignore</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;nim                       ; python + lisp at the speed of c</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;nix                       ; I hereby declare &#34;nix geht mehr!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;ocaml                     ; an objective camel</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">org</span> <span class="nv">+dragdrop</span> <span class="nv">+gnuplot</span>     <span class="c1">; organize your plain life in plain text</span>
</span></span><span class="line"><span class="cl">     <span class="nv">+hugo</span> <span class="nv">+journal</span>
</span></span><span class="line"><span class="cl">     <span class="nv">+jupyter</span> <span class="nv">+noter</span>
</span></span><span class="line"><span class="cl">     <span class="nv">+pandoc</span> <span class="nv">+present</span>
</span></span><span class="line"><span class="cl">     <span class="nv">+pretty</span> <span class="nv">+roam2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;php                       ; perl&#39;s insecure younger brother</span>
</span></span><span class="line"><span class="cl"><span class="nv">plantuml</span>                    <span class="c1">; diagrams for confusing people more</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;purescript                ; javascript, but functional</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">python</span> <span class="nv">+lsp</span> <span class="nv">+pyright</span><span class="p">)</span>      <span class="c1">; beautiful is better than ugly</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;qt                        ; the &#39;cutest&#39; gui framework ever</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;racket                    ; a DSL for DSLs</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;raku                      ; the artist formerly known as perl6</span>
</span></span><span class="line"><span class="cl"><span class="nv">rest</span>                        <span class="c1">; Emacs as a REST client</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;rst                       ; ReST in peace</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(ruby +rails)             ; 1.step {|i| p &#34;Ruby is #{i.even? ? &#39;love&#39; : &#39;life&#39;}&#34;}</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">rust</span> <span class="nv">+lsp</span> <span class="nv">+tree-sitter</span><span class="p">)</span>    <span class="c1">; Fe2O3.unwrap().unwrap().unwrap().unwrap()</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;scala                     ; java, but good</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(scheme +guile)           ; a fully conniving family of lisps</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">sh</span> <span class="nv">+tree-sitter</span><span class="p">)</span>           <span class="c1">; she sells {ba,z,fi}sh shells on the C xor</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;sml</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;solidity                  ; do you need a blockchain? No.</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;swift                     ; who asked for emoji variables?</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;terra                     ; Earth and Moon in alignment for performance.</span>
</span></span><span class="line"><span class="cl"><span class="nv">web</span>                         <span class="c1">; the tubes</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;yaml                      ; JSON, but readable</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">zig</span> <span class="nv">+lsp</span><span class="p">)</span>                  <span class="c1">; C, but simpler</span>
</span></span></code></pre></div><h3 id="输入法">输入法</h3>
<p>增加一些输入法，在 macOS 系统下基本不需要。</p>
<p><a id="code-snippet--doom-input"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;bidi                      ; (tfel ot) thgir etirw uoy gnipleh</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;chinese</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;japanese</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;layout                    ; auie,ctsrnm is the superior home row</span>
</span></span></code></pre></div><h3 id="万能的-emacs">万能的 Emacs</h3>
<p>有人会用 Emacs 来做任何事，包括电子邮件、IRC、RSS 等等，甚至听歌看视频，目前我只用邮件。</p>
<p><a id="code-snippet--doom-email"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">&#34;mu&#34;</span><span class="p">)</span> <span class="p">(</span><span class="nv">mu4e</span> <span class="nv">+org</span> <span class="nv">+gmail</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;notmuch</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(wanderlust +gmail)</span>
</span></span></code></pre></div><p><a id="code-snippet--doom-app"></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;calendar</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;emms</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;everywhere                ; *leave* Emacs!? You must be joking</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;irc                       ; how neckbeards socialize</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(rss +org)                ; emacs as an RSS reader</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;twitter                   ; twitter client https://twitter.com/vnought</span>
</span></span></code></pre></div><h2 id="基本设置">基本设置</h2>
<p>这里是一些只要 Emacs 启动就需要尽快设置的内容，不需要考虑延迟加载的一些设置，包括一些 Emacs 本身的全局设置，也包括一些需要尽快加载的模块和包的基本设置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;; config.el -*- lexical-binding: t; -*-</span>
</span></span></code></pre></div><h3 id="个人信息">个人信息</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nf">user-full-name</span> <span class="s">&#34;Neo Lee&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">user-mail-address</span> <span class="s">&#34;neo@soulhacker.me&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="更好的缺省值">更好的缺省值</h3>
<p>Doom 大部分的缺省配置都是优化且实用的，但还是有少量的需要修改。其中 <code>word-wrap-by-category</code> 这个选项是 Emacs 28 新加的，修复了 CJK 语言文本自动换行的老 bug。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq-default</span>
</span></span><span class="line"><span class="cl"> <span class="nv">window-combination-resize</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl"> <span class="nv">x-stretch-cursor</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl"> <span class="nv">yas-triggers-in-field</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl"> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span>
</span></span><span class="line"><span class="cl"> <span class="nv">undo-limit</span> <span class="mi">80000000</span>
</span></span><span class="line"><span class="cl"> <span class="nv">auto-save-default</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl"> <span class="nv">scroll-preserve-screen-position</span> <span class="ss">&#39;always</span>
</span></span><span class="line"><span class="cl"> <span class="nv">scroll-margin</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"> <span class="nv">word-wrap-by-category</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl"> <span class="nv">all-the-icons-scale-factor</span> <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-subword-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></div><p>因为我不用 <code>evil</code> 所以需要给 <em>local leader</em> 一个方便的组合键。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">map!</span> <span class="s">&#34;C-z&#34;</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">doom-localleader-alt-key</span> <span class="s">&#34;C-z&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>如果想显示行号，将这两个变量设为 <code>t</code> ；如果想显示相对行号，将第二个变量值设为 <code>'relative</code> 或 <code>'visual</code> 。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">display-line-numbers</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">display-line-numbers-type</span> <span class="no">nil</span><span class="p">)</span>
</span></span></code></pre></div><p>Org 的根目录需要尽早设置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-directory</span> <span class="s">&#34;~/Code/Org/&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>缺省配置下 <code>treemacs</code> 只会显示文件的 <code>git</code> 状态，改为 <code>'extended</code> 可以显示文件和目录的状态，另一个选项 <code>'deferred</code> 似乎有问题；这个选项要在 <code>treemacs</code> 加载前设置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">+treemacs-git-mode</span> <span class="ss">&#39;extended</span><span class="p">)</span>
</span></span></code></pre></div><p>这个开关可以让 <code>treemacs</code> 将空目录尽可能合并为一项来显示，数值代表同时能合并显示的目录数上限。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">treemacs</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">treemacs-collapse-dirs</span> <span class="mi">200</span><span class="p">))</span>
</span></span></code></pre></div><p>另外我们习惯自动打开 <code>treemacs</code> 。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;window-setup-hook</span> <span class="nf">#&#39;</span><span class="nv">treemacs</span> <span class="ss">&#39;append</span><span class="p">)</span>
</span></span></code></pre></div><p>使用 PlantUML 用本地模式比较靠谱。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">plantuml-jar-path</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">user-emacs-directory</span><span class="p">)</span> <span class="s">&#34;plantuml/plantuml.jar&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nv">plantuml-default-exec-mode</span> <span class="ss">&#39;jar</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="非图形界面下运行">非图形界面下运行</h3>
<p>有时我们无法在图形界面下运行 Emacs，这时就需要下面这些 <em>tweak</em> ：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">display-graphic-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-c b&#34;</span> <span class="ss">&#39;treemacs-select-window</span>
</span></span><span class="line"><span class="cl">   <span class="p">[</span><span class="nv">mouse-4</span><span class="p">]</span> <span class="ss">&#39;scroll-down-line</span>
</span></span><span class="line"><span class="cl">   <span class="p">[</span><span class="nv">mouse-5</span><span class="p">]</span> <span class="ss">&#39;scroll-up-line</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="字体和主题">字体和主题</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">+main-font</span> <span class="s">&#34;Iosevka Fixed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">+unicode-font</span> <span class="s">&#34;Sarasa Fixed SC&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">doom-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="nv">+main-font</span> <span class="nb">:size</span> <span class="mi">16</span> <span class="nb">:weight</span> <span class="ss">&#39;light</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-big-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="nv">+main-font</span> <span class="nb">:size</span> <span class="mi">20</span> <span class="nb">:weight</span> <span class="ss">&#39;light</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-variable-pitch-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="nv">+main-font</span><span class="p">)</span> <span class="c1">;; inherits :size from doom-font</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-serif-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="nv">+main-font</span> <span class="nb">:weight</span> <span class="ss">&#39;light</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-unicode-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="nv">+unicode-font</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">doom-themes-enable-bold</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-themes-enable-italic</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></div><p>随系统切换 light 和 dark mode 主题，利用 macOS 下 <code>emacs-plus</code> 增加的 <code>ns-system-appearance-change-functions</code> 钩子来实现。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; (setq +light-theme &#39;doom-one-light</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;       +dark-theme &#39;doom-vibrant)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (setq +light-theme &#39;modus-operandi</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;       +dark-theme &#39;modus-vivendi)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (setq +light-theme &#39;doom-acario-light</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;       +dark-theme &#39;doom-acario-dark)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">+light-theme</span> <span class="ss">&#39;doom-flatwhite</span>
</span></span><span class="line"><span class="cl">      <span class="nv">+dark-theme</span> <span class="ss">&#39;doom-city-lights</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (setq +light-theme &#39;doom-opera-light</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;       +dark-theme &#39;doom-opera)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (setq +light-theme &#39;doom-nord-light</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;       +dark-theme &#39;doom-nord)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">+apply-theme</span> <span class="p">(</span><span class="nv">appearance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Load theme, taking current system APPEARANCE into consideration.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">mapc</span> <span class="nf">#&#39;</span><span class="nv">disable-theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">pcase</span> <span class="nv">appearance</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="ss">&#39;light</span> <span class="p">(</span><span class="nv">load-theme</span> <span class="nv">+light-theme</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="ss">&#39;dark</span> <span class="p">(</span><span class="nv">load-theme</span> <span class="nv">+dark-theme</span> <span class="no">t</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;ns-system-appearance-change-functions</span> <span class="ss">&#39;+apply-theme</span><span class="p">)</span>
</span></span></code></pre></div><p>其他关联主题和字体设置， <code>treemacs</code> 适配 <code>nerd-icons</code> 似乎已经合并进 Doom ，不再需要手动设置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">doom-themes-org-config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;(after! treemacs</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  :config</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  (doom-themes-treemacs-config)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  (treemacs-load-theme &#34;nerd-icons&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  )</span>
</span></span></code></pre></div><h3 id="状态条">状态条</h3>
<p>Doom 缺省的状态条是 <code>doom-modeline</code> ，可能是几个状态条方案里最漂亮的一个，不过这问题见仁见智，选自己喜欢的就好。目前版本缺省配置就挺好，以前的 <em>hacking</em> 都被我删了。</p>
<h3 id="切换窗口">切换窗口</h3>
<p>预制模块 <code>ace-window</code> 加强了 <code>C-x o</code> 的功能，当多于2个窗口时会高亮显示每个窗口左上角的一个字母，按下这个字母就切换到对应窗口，但这个字母的显示非常小，很不醒目，解决方案很简单，定制这个字母显示的样式，把它变大再加上红色底，就醒目了。 <code>ace-window</code> 还有不少别的功能，比如激活之后可以按 <code>x</code> 来删除当前窗口，按 <code>m</code> 来与选择的窗口交换内容等，具体可参考<a href="https://github.com/abo-abo/ace-window">官网说明</a>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">custom-set-faces!</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">(</span><span class="nv">aw-leading-char-face</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:foreground</span> <span class="s">&#34;white&#34;</span> <span class="nb">:background</span> <span class="s">&#34;red&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:weight</span> <span class="nv">bold</span> <span class="nb">:height</span> <span class="mf">1.5</span> <span class="nb">:box</span> <span class="p">(</span><span class="nb">:line-width</span> <span class="mi">10</span> <span class="nb">:color</span> <span class="s">&#34;red&#34;</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="花式符号">花式符号</h3>
<p>预制模块 <code>ligature</code> 及其 <code>+extra</code> 选项会用一些漂亮的文字符号来替代一些固定文本组合，比如用 <code>λ</code> 代替 Lisp 类语言里的 <code>lambda</code> 和 <code>fn</code> 关键字，用 <code>𝒇</code> 代替 <code>function</code> 关键字，用 <code>⟻</code> 代替 <code>import</code> 关键字等，没啥用就图个乐，不过在某些语言里这个玩意儿会影响理解和编码，所以对这些语言禁用掉是个明智选择。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">+appened-to-negation-list</span> <span class="p">(</span><span class="nv">head</span> <span class="nv">tail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">sequencep</span> <span class="nv">head</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">delete-dups</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">tail</span><span class="p">)</span> <span class="ss">&#39;not</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nf">append</span> <span class="nv">head</span> <span class="nv">tail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">append</span> <span class="nv">tail</span> <span class="nv">head</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="nv">tail</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">modulep!</span> <span class="nb">:ui</span> <span class="nv">ligatures</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">+ligatures-extras-in-modes</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">+appened-to-negation-list</span>
</span></span><span class="line"><span class="cl">         <span class="nv">+ligatures-extras-in-modes</span>
</span></span><span class="line"><span class="cl">         <span class="o">&#39;</span><span class="p">(</span><span class="nv">not</span> <span class="nv">c-mode</span> <span class="nv">c++-mode</span> <span class="nv">emacs-lisp-mode</span> <span class="nv">python-mode</span> <span class="nv">scheme-mode</span> <span class="nv">racket-mode</span> <span class="nv">rust-mode</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">+ligatures-in-modes</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">+appened-to-negation-list</span>
</span></span><span class="line"><span class="cl">         <span class="nv">+ligatures-in-modes</span>
</span></span><span class="line"><span class="cl">         <span class="o">&#39;</span><span class="p">(</span><span class="nv">not</span> <span class="nv">emacs-lisp-mode</span> <span class="nv">scheme-mode</span> <span class="nv">racket-mode</span><span class="p">))))</span>
</span></span></code></pre></div><h3 id="语言服务器">语言服务器</h3>
<p>Emacs 支持微软开源的 LSP 接口以及各种各样的语言服务器时间还不长，问题也有一些，不过未来可期。 <code>lsp-ui</code> 提供了大量的定制选项。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">lsp</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:custom</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">lsp-log-io</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">lsp-print-io</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">lsp-document-sync-method</span> <span class="ss">&#39;incremental</span> <span class="c1">; none, full, incremental, or nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">lsp-response-timeout</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:hook</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">lsp-mode</span> <span class="o">.</span> <span class="nv">lsp-ui-mode</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">lsp-ui</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:custom</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span>
</span></span><span class="line"><span class="cl">   <span class="c1">; lsp-enable-symbol-highlighting nil</span>
</span></span><span class="line"><span class="cl">   <span class="c1">; lsp-lens-enable nil</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-headerline-breadcrumb-enable</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">   <span class="c1">; lsp-diagnostics-provider :none</span>
</span></span><span class="line"><span class="cl">   <span class="c1">; lsp-completion-provider :none</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-enable</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-show-with-mouse</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-show-with-cursor</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-header</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-include-signature</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-position</span> <span class="ss">&#39;at-point</span> <span class="c1">;; top, bottom, or at-point</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-max-width</span> <span class="mi">120</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-max-height</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-use-childframe</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-doc-use-webkit</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-sideline-enable</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-sideline-show-code-actions</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-sideline-show-hover</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-sideline-ignore-duplicate</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-sideline-show-symbol</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-sideline-show-diagnostics</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-peek-enable</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-peek-fontify</span> <span class="ss">&#39;on-demand</span> <span class="c1">;; never, on-demand, or always</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-imenu-enable</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">   <span class="nv">lsp-ui-imenu-kind-position</span> <span class="ss">&#39;top</span>
</span></span><span class="line"><span class="cl">   <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:preface</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">+toggle-lsp-ui-doc</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">lsp-ui-doc-mode</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">lsp-ui-doc-mode</span> <span class="mi">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">lsp-ui-doc-hide</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">lsp-ui-doc-mode</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">lsp-ui-doc-show</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">lsp-mode-map</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s">&#34;C-c l r&#34;</span> <span class="nf">#&#39;</span><span class="nv">lsp-ui-peek-find-references</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s">&#34;C-c l j&#34;</span> <span class="nf">#&#39;</span><span class="nv">lsp-ui-peek-find-definitions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s">&#34;C-c l i&#34;</span> <span class="nf">#&#39;</span><span class="nv">lsp-ui-peek-find-implementation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s">&#34;C-c l m&#34;</span> <span class="nf">#&#39;</span><span class="nv">lsp-ui-imenu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s">&#34;C-c l s&#34;</span> <span class="nf">#&#39;</span><span class="nv">lsp-ui-sideline-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s">&#34;C-c l d&#34;</span> <span class="nf">#&#39;</span><span class="nv">+toggle-lsp-ui-doc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><p>使用 <a href="https://github.com/blahgeek/emacs-lsp-booster">lsp-booster</a> 来优化语言服务器解析 JSON 数据的性能。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">lsp-booster--advice-json-parse</span> <span class="p">(</span><span class="nv">old-fn</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Try to parse bytecode instead of json.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">or</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nf">following-char</span><span class="p">)</span> <span class="sc">?#</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">bytecode</span> <span class="p">(</span><span class="nf">read</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">byte-code-function-p</span> <span class="nv">bytecode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">funcall</span> <span class="nv">bytecode</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nf">apply</span> <span class="nv">old-fn</span> <span class="nv">args</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">progn</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;json</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                       <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;json-parse-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="ss">&#39;json-parse-buffer</span>
</span></span><span class="line"><span class="cl">              <span class="ss">&#39;json-read</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">:around</span>
</span></span><span class="line"><span class="cl">            <span class="nf">#&#39;</span><span class="nv">lsp-booster--advice-json-parse</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">lsp-booster--advice-final-command</span> <span class="p">(</span><span class="nv">old-fn</span> <span class="nv">cmd</span> <span class="kp">&amp;optional</span> <span class="nv">test?</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Prepend emacs-lsp-booster command to lsp CMD.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">orig-result</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">old-fn</span> <span class="nv">cmd</span> <span class="nv">test?</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">test?</span><span class="p">)</span>                             <span class="c1">;; for check lsp-server-present?</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">file-remote-p</span> <span class="nv">default-directory</span><span class="p">))</span> <span class="c1">;; see lsp-resolve-final-command, it would add extra shell wrapper</span>
</span></span><span class="line"><span class="cl">             <span class="nv">lsp-use-plists</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">functionp</span> <span class="ss">&#39;json-rpc-connection</span><span class="p">))</span>  <span class="c1">;; native json-rpc</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nv">executable-find</span> <span class="s">&#34;emacs-lsp-booster&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">command-from-exec-path</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">orig-result</span><span class="p">))))</span>  <span class="c1">;; resolve command from exec-path (in case not found in $PATH)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">setcar</span> <span class="nv">orig-result</span> <span class="nv">command-from-exec-path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Using emacs-lsp-booster for %s!&#34;</span> <span class="nv">orig-result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">cons</span> <span class="s">&#34;emacs-lsp-booster&#34;</span> <span class="nv">orig-result</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="nv">orig-result</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;lsp-resolve-final-command</span> <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">lsp-booster--advice-final-command</span><span class="p">)</span>
</span></span></code></pre></div><p>针对具体语言的一些配置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;js-mode-hook</span> <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;flycheck-disabled-checkers</span> <span class="ss">&#39;lsp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">lsp-javascript-validate-enable</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">      <span class="nv">lsp-javascript-suggest-enabled</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">      <span class="nv">lsp-javascript-suggestion-actions-enabled</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">      <span class="nv">lsp-pyright-langserver-command</span> <span class="s">&#34;basedpyright&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">lsp-zig-zls-executable</span> <span class="s">&#34;~/Code/Repo/zls/zig-out/bin/zls&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="拼写检查">拼写检查</h3>
<p>无论使用 <code>spell-fu</code> 还是 <code>flyspell</code> 都需要配置个人词汇表的保存位置，我都放在 <code>doom-user-dir</code> 目录下了。另外 <code>flyspell</code> 激活错词修改菜单的缺省操作是鼠标中键（滚轮），MacBook 上没这玩意儿啊，所以我给改成 <code>Command+鼠标主键</code> 了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">spell-fu</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">+spell-fu-register-dictionary</span> <span class="p">(</span><span class="nv">lang</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Add `LANG` to spell-fu multi-dict, with a personal dictionary.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; Add the dictionary</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">spell-fu-dictionary-add</span> <span class="p">(</span><span class="nv">spell-fu-get-ispell-dictionary</span> <span class="nv">lang</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">personal-dict-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;aspell.%s.pws&#34;</span> <span class="nv">lang</span><span class="p">)</span> <span class="nv">doom-user-dir</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; Create an empty personal dictionary if it doesn&#39;t exists</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">personal-dict-file</span><span class="p">)</span> <span class="p">(</span><span class="nf">write-region</span> <span class="s">&#34;&#34;</span> <span class="no">nil</span> <span class="nv">personal-dict-file</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; Add the personal dictionary</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">spell-fu-dictionary-add</span> <span class="p">(</span><span class="nv">spell-fu-get-personal-dictionary</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s-personal&#34;</span> <span class="nv">lang</span><span class="p">)</span> <span class="nv">personal-dict-file</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;spell-fu-mode-hook</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">+spell-fu-register-dictionary</span> <span class="s">&#34;en&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">flyspell</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">ispell-personal-dictionary</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;aspell.pws&#34;</span> <span class="nv">doom-user-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span>
</span></span><span class="line"><span class="cl">   <span class="p">[</span><span class="nv">s-down-mouse-1</span><span class="p">]</span> <span class="ss">&#39;flyspell-correct-word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h3 id="电子邮件">电子邮件</h3>
<p>在配置好 <code>isync</code> 和 <code>mu</code> 之后（比较 tricky 的部分是使用 GnuPG 来加密密码，可以参考<a href="https://f-santos.gitlab.io/2020-04-24-mu4e.html">这篇</a>以及<a href="https://gist.github.com/koshatul/2427643668d4e89c0086f297f9ed2130">这篇</a>），在 Emacs 中使用 <code>mu4e</code> 就很简单了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">set-email-account!</span> <span class="s">&#34;neo&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">((</span><span class="nv">mu4e-sent-folder</span>       <span class="o">.</span> <span class="s">&#34;/neo/Sent&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">mu4e-drafts-folder</span>     <span class="o">.</span> <span class="s">&#34;/neo/Drafts&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">mu4e-trash-folder</span>      <span class="o">.</span> <span class="s">&#34;/neo/Trash&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">mu4e-refile-folder</span>     <span class="o">.</span> <span class="s">&#34;/neo/All Mail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">smtpmail-smtp-user</span>     <span class="o">.</span> <span class="s">&#34;neo@soulhacker.me&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">user-mail-address</span>      <span class="o">.</span> <span class="s">&#34;neo@soulhacker.me&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">mu4e-compose-signature</span> <span class="o">.</span> <span class="s">&#34;--\nNeo Lee a.k.a. soulhacker&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">send-mail-function</span> <span class="ss">&#39;smtpmail-send-it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">smtpmail-smtp-server</span> <span class="s">&#34;localhost&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">smtpmail-smtp-service</span> <span class="mi">1025</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">smtpmail-stream-type</span> <span class="ss">&#39;starttls</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-msg-signature</span> <span class="s">&#34;\n#+begin_signature\n--\nNeo Lee a.k.a. soulhacker\n#+end_signature&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">mu4e</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">mu4e-headers-auto-update</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">mu4e-update-interval</span> <span class="mi">120</span>
</span></span><span class="line"><span class="cl">        <span class="nv">mu4e-view-show-images</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">mu4e-use-fancy-chars</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h2 id="补充软件包">补充软件包</h2>
<p>Doom 的缺省配置和预制模块能覆盖我绝大部分需求，所以需要我另外添加的软件包很少，这些软件包需要写在 <code>packages.el</code> 里。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;; packages.el -*- no-byte-compile: t; -*-</span>
</span></span></code></pre></div><h3 id="窗口移动">窗口移动</h3>
<p>用快捷键快速在几个窗口间交换 buffer，比如同时打开 <code>.c</code> 和 <code>.h</code> 文件，先在左边窗口编辑 <code>.h</code> 文件，然后把右边窗口的 <code>.c</code> 文件换过来进行编辑，使用这个包用一个组合键就能做到。其实预制模块里的 <code>ace-window</code> 也可以做类似的事情，但 <code>buffer-mover</code> 一个按键搞定更快。这里我用 <code>:recipe</code> 子句来禁用这个包的编译，因为这个包有个 bug，编译后会报错。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">buffer-move</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:build</span> <span class="p">(</span><span class="nb">:not</span> <span class="nv">compile</span><span class="p">)))</span>
</span></span></code></pre></div><p>安装和启用之后，在 <code>config.el</code> 里配置自己习惯的按键组合（我用 <code>Control+Command+方向键</code> ）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">map!</span>
</span></span><span class="line"><span class="cl"> <span class="p">[</span><span class="nv">C-s-up</span><span class="p">]</span>        <span class="nf">#&#39;</span><span class="nv">buf-move-up</span>
</span></span><span class="line"><span class="cl"> <span class="p">[</span><span class="nv">C-s-down</span><span class="p">]</span>      <span class="nf">#&#39;</span><span class="nv">buf-move-down</span>
</span></span><span class="line"><span class="cl"> <span class="p">[</span><span class="nv">C-s-left</span><span class="p">]</span>      <span class="nf">#&#39;</span><span class="nv">buf-move-left</span>
</span></span><span class="line"><span class="cl"> <span class="p">[</span><span class="nv">C-s-right</span><span class="p">]</span>     <span class="nf">#&#39;</span><span class="nv">buf-move-right</span>
</span></span><span class="line"><span class="cl"> <span class="p">)</span>
</span></span></code></pre></div><h3 id="锁定可靠版本">锁定可靠版本</h3>
<p>缺省的 <em>Doom Emacs</em> 有着过于激进的版本跟进策略，有些包的 <em>master</em> 分支并不可信，一旦出现问题我们需要锁定在可靠的版本上。</p>
<h4 id="org-mode"><code>org-mode</code></h4>
<p>最新的 <code>org-mode</code> <em>9.7</em> 开发分支有不少问题，而 <em>Doom Emacs</em> 缺省会跟着 <code>org-mode</code> 的 <em>master</em> 分支，经常会破坏一些本来正常工作的软件包，所以我们目前需要锁在 <em>9.6</em> 最新稳定版本。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">org</span> <span class="nb">:pin</span> <span class="s">&#34;071c6e986c424d2e496be7d0815d6e9cd83ae4e6&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>添加另外一些与 <code>org-mode</code> 相关的软件包。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">jupyter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">ox-hugo</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="知识网络">知识网络</h3>
<p><code>org-roam-ui</code> <a href="https://github.com/org-roam/org-roam-ui">→</a> 提供强大的知识网络笔记系统 <code>org-roam</code> 的网络可视化，并可与 <code>org-roam</code> 紧密整合。注意 <code>org-roam-ui</code> 只支持 <code>org-roam v2</code> ，如果使用 <code>org-roam v1</code> 的话请用 <code>org-roam-server</code> <a href="https://github.com/org-roam/org-roam-server">→</a>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">org-roam-ui</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="公式预览">公式预览</h3>
<p><code>xenops</code> 和 <code>org-fragtog</code> 都是用来在 <code>org-mode</code> 里实时渲染显示 \(LaTeX\) 公式的，它们都会实时将公式渲染为图片（前者用 SVG 格式，后者用 PNG 格式）并缓存，然后显示出来，区别在于 <code>org-fragtog</code> 是同步模式，渲染时会卡住 Emacs，等它好了你才能继续操作，而 <code>xenops</code> 使用 <code>emacs-aio</code> 实现异步渲染，它干活的时候你也可以继续干活，它渲染好就会自动显示出来。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">xenops</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="幻灯片">幻灯片</h3>
<p><code>dslide</code> 可以直接把 <code>org-mode</code> 变成幻灯片。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">dslide</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="编程语言-clojure">编程语言 - Clojure</h3>
<p><code>clj-refactor</code> 这个包需要和后端 Clojure 的 <code>refactor-nrepl</code> 包版本同步，且它们更新都挺频繁，所以最好解放版本限制。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">unpin!</span> <span class="nv">clj-refactor</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="编程语言-python">编程语言 - Python</h3>
<p>Doom 其实有个大一统的源代码格式美化模块（ <code>:editor format</code> ），但我还没时间深入研究，而且这个模块和 LSP 是彼此独立的，不知道有什么坑，所以没开。针对比较有这个需求的 Python 语言单独加了 <code>black</code> 这个懒汉的选择，作为 LSP 方案的保底。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">python-black</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="大语言模型">大语言模型</h3>
<p>近期涌现了一批将大语言模型 <em>Large Language Model</em> 的能力整合进 Emacs 的工具，我们也可以来试试。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">gptel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">ellama</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="阅读">阅读</h3>
<p>Doom 自带 <code>eww</code> 浏览器，所以我只需要加一个 <code>epub</code> 的阅读器 <code>nov.el</code> 。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">nov</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="小玩具">小玩具</h3>
<p><code>keycast</code> 可以跟踪并显示所有按键操作，在录制与 Emacs 有关的 screencast 时有用，其实我用的很少，ScreenFlow 提供更漂亮的解决方案，但在 Linux 下是个不错的方案。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">keycast</span><span class="p">)</span>
</span></span></code></pre></div><p>这个包允许你在 Emacs 里查询、下载和查看 <a href="https://xkcd.com">xkcd</a> 漫画，嘿嘿嘿！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">xkcd</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="org-mode">Org Mode</h2>
<p><code>org-mode</code> 是 Emacs 的招牌应用，一个全副武装的 <code>org-mode</code> 可以在一致的环境下完成日程计划、笔记、博客、论文等各种写作任务，不仅可以写出文本、结构化列表、表格，还可以插入图片、 \(LaTeX\) 公式、可运行的程序代码、可追踪的任务，还可以借助 <code>org-roam</code> 实现笔记的知识网络化。这些功能是以 <code>org-mode</code> 为中心的一组软件包配合实现的，所以配置也相对多一点。</p>
<h3 id="基本配置">基本配置</h3>
<p>设置 <code>org-agenda</code> 使用的 Org 文档的位置，可以指定目录和文件名 <em>pattern</em> 把所有 <code>.org</code> 文件放进去：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-files</span> <span class="p">(</span><span class="nv">directory-files-recursively</span> <span class="nv">org-directory</span> <span class="s">&#34;\\.org$&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>但通常还是指定几个分类任务文件就好了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-files</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;Inbox.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;Private.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;Work.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;Projects.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;Notes.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">)))</span>
</span></span></code></pre></div><p>另一个和 <code>org-agenda</code> 有关的场景，就是用 <code>org-roam</code> 写东西很快就会有非常多的文件，有些笔记一时写不完可以加上 <code>TODO</code> 标签，然后就需要一个又快又方便的手段来整理这些 <code>TODO</code> 列表，对这个问题 Emacs 社区有位 Boris Buliga（a.k.a <a href="https://github.com/d12frosted">d12frosted</a>，这位还是 <code>homebrew-emacs-plus</code> 和 <code>flyspell-correct</code> 的维护者）给出了一个<a href="https://d12frosted.io/posts/2021-01-16-task-management-with-roam-vol5.html">漂亮的解决方案</a>，简单说就是检测到 <code>TODO</code> 时自动给文件打一个 <code>project</code> 标签（如果检测到当前文件所有 <code>TODO</code> 都没有了就自动移除标签），然后直接通过 org-roam 的数据库查询动态将这些文件添进 <code>org-agenda</code> 文件列表。从他分享的 <a href="https://gist.github.com/d12frosted/a60e8ccb9aceba031af243dff0d19b2e">gist</a> 克隆代码到本地，然后加载就可以了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-agenda</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">load!</span> <span class="s">&#34;lisp/vulpea-agenda&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>原来的版本有个问题，就是我们上面给变量 <code>org-agenda-files</code> 指定的文件会被移除，所以我做了一点 patch 之后才合用 <a href="https://gist.github.com/neolee/7e0c2abf2254c72baafb4a1000f0fbf0">→</a>。</p>
<p>Org 文档导出 \(LaTeX\) 文档时需要做一些配置，一是引入 <code>ctex</code> 包，否则中文处理会有问题；二是配置一下带链接文本的格式，不然会是带红色框的文本，非常恐怖；另外是一些 \(LaTeX\) 的常规设置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-default-packages-alist</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">remove</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;AUTO&#34;</span> <span class="s">&#34;inputenc&#34;</span> <span class="no">t</span><span class="p">)</span> <span class="nv">org-latex-default-packages-alist</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-pdf-process</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;xelatex -interaction nonstopmode %f&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="s">&#34;xelatex -interaction nonstopmode %f&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-packages-alist</span>
</span></span><span class="line"><span class="cl">        <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;&#34;</span> <span class="s">&#34;ctex&#34;</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-hyperref-template</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;\\hypersetup{linktoc=all,colorlinks=true,urlcolor=blue,linkcolor=blue}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><p>缺省的 \(LaTeX\) 模板的目录之后直接会接上正文，但一般的排版习惯会希望正文另起一页，这个简单定制一下就可以了：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-toc-command</span> <span class="s">&#34;\\tableofcontents \\clearpage\n\n&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>在编辑 Org 文档时，经常点击链接跳转到另一篇笔记，这时候快速返回可以设置为快捷键，我用的是 <code>Control-Command-b</code> 。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">org-mode-map</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;C-s-b&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-mark-ring-goto</span>
</span></span><span class="line"><span class="cl">        <span class="p">))</span>
</span></span></code></pre></div><p>维护很多 Org 笔记时，记下笔记最后编辑时间会很有用，这个事情很适合交给 Emacs 自己做，可以利用 Emacs 的 <a href="https://www.emacswiki.org/emacs/TimeStamp">Time Stamp</a> 功能实现。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-mode-hook</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">setq-local</span> <span class="nv">time-stamp-active</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">                          <span class="nv">time-stamp-line-limit</span> <span class="mi">18</span>
</span></span><span class="line"><span class="cl">                          <span class="nv">time-stamp-start</span> <span class="s">&#34;^#\\+last_modified: [ \t]*&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="nv">time-stamp-end</span> <span class="s">&#34;$&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="nv">time-stamp-format</span> <span class="s">&#34;\[%Y-%m-%d %a %H:%M:%S\]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;before-save-hook</span> <span class="ss">&#39;time-stamp</span> <span class="no">nil</span> <span class="ss">&#39;local</span><span class="p">))))</span>
</span></span></code></pre></div><p>需要这个功能的 Org 笔记在 <em>header</em> 里加入下面一行即可（在笔记的前18行都可以）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+last_modified</span><span class="c">: [ ]</span>
</span></span></code></pre></div><h3 id="运行代码块">运行代码块</h3>
<p>借助 <code>org-babel</code> 来实现可运行的代码块，可以在代码块中应用对应的 <em>major mode</em> ，提供良好的语法高亮及编辑功能。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-src</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-src-lang-modes</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;plantuml&#34;</span> <span class="o">.</span> <span class="nv">plantuml</span><span class="p">)))</span>
</span></span></code></pre></div><p>另外我还会用 Jupyter 来运行不同语言引擎。注意第一段里 <code>:kernel</code> 参数，需要设为系统里存在的某个 Jupyter <em>kernel</em> 的名字，且系统环境里应该装有 Jupyter（即系统 <code>PATH</code> 中能找到 <code>jupyter</code> 程序）；使用中如果需要 <code>pip</code> 安装 Python 软件包，也是安装在这个 <em>kernel</em> 环境下。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-babel-default-header-args:jupyter-python</span> <span class="o">&#39;</span><span class="p">((</span><span class="nb">:async</span> <span class="o">.</span> <span class="s">&#34;no&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                     <span class="p">(</span><span class="nb">:session</span> <span class="o">.</span> <span class="s">&#34;jp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                     <span class="p">(</span><span class="nb">:kernel</span> <span class="o">.</span> <span class="s">&#34;wop&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-tempo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-babel-do-load-languages</span> <span class="ss">&#39;org-babel-load-languages</span>
</span></span><span class="line"><span class="cl">                               <span class="o">&#39;</span><span class="p">((</span><span class="nv">emacs-lisp</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">python</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">shell</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">latex</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">sql</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">sqlite</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">calc</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nv">jupyter</span> <span class="o">.</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-src</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">lang</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">python</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">cl-pushnew</span> <span class="p">(</span><span class="nf">cons</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;jupyter-%s&#34;</span> <span class="nv">lang</span><span class="p">)</span> <span class="nv">lang</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nv">org-src-lang-modes</span> <span class="nb">:key</span> <span class="nf">#&#39;car</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h3 id="知识网络">知识网络</h3>
<h4 id="org-roam">org-roam</h4>
<p>其实我刚开始用 <code>org-roam</code> ，所以只有最简单的配置，一些复杂的模板之类的都还没开始用。这里最重要的配置是 Roam 笔记的根目录，另外我稍微修改了下缺省的 <em>capture template</em> ，在元数据里加了 <em>tag</em> 。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">org-roam</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:custom</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-directory</span> <span class="p">(</span><span class="nv">file-truename</span> <span class="s">&#34;~/Code/Org/roam/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-completion-everywhere</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-c n l&#34;</span> <span class="o">.</span> <span class="nv">org-roam-buffer-toggle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n f&#34;</span> <span class="o">.</span> <span class="nv">org-roam-node-find</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n g&#34;</span> <span class="o">.</span> <span class="nv">org-roam-graph</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n i&#34;</span> <span class="o">.</span> <span class="nv">org-roam-node-insert</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n c&#34;</span> <span class="o">.</span> <span class="nv">org-roam-capture</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n j&#34;</span> <span class="o">.</span> <span class="nv">org-roam-dailies-capture-today</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-capture-templates</span>
</span></span><span class="line"><span class="cl">        <span class="o">`</span><span class="p">((</span><span class="s">&#34;d&#34;</span> <span class="s">&#34;default&#34;</span> <span class="nv">plain</span> <span class="s">&#34;%?&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head</span> <span class="s">&#34;%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="s">&#34;#+title: ${title}\n#+filetags:\n\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:unnarrowed</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-db-autosync-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-roam-protocol</span><span class="p">))</span>
</span></span></code></pre></div><h4 id="org-roam-ui">org-roam-ui</h4>
<p>这个知识网络的可视化会显示在浏览器中，通过 <em>websocket</em> 与 Emacs 通信。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-roam</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">use-package!</span> <span class="nv">websocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">use-package!</span> <span class="nv">org-roam-ui</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-ui-sync-theme</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">          <span class="nv">org-roam-ui-follow</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">          <span class="nv">org-roam-ui-update-on-save</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">          <span class="nv">org-roam-ui-open-on-start</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h3 id="实时公式预览">实时公式预览</h3>
<p><code>xenops</code> 基本配置，注意公式显示的大小可用变量 <code>xenops-math-image-scale-factor</code> 微调。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">display-graphic-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">use-package!</span> <span class="nv">xenops</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:hook</span> <span class="p">(</span><span class="nv">latex-mode</span> <span class="o">.</span> <span class="nv">xenops-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:hook</span> <span class="p">(</span><span class="nv">LaTeX-mode</span> <span class="o">.</span> <span class="nv">xenops-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-mode</span> <span class="o">.</span> <span class="nv">xenops-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">xenops-mode-map</span>
</span></span><span class="line"><span class="cl">          <span class="nb">:n</span> <span class="s">&#34;RET&#34;</span> <span class="nf">#&#39;</span><span class="nv">xenops-dwim</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">xenops-cache-directory</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">doom-cache-dir</span> <span class="s">&#34;xenops/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nv">xenops-reveal-on-entry</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">          <span class="nv">xenops-math-latex-process</span> <span class="ss">&#39;dvisvgm</span>
</span></span><span class="line"><span class="cl">          <span class="nv">xenops-math-image-scale-factor</span> <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl">          <span class="p">)))</span>
</span></span></code></pre></div><h2 id="大语言模型">大语言模型</h2>
<p>大语言模型相关工具 <code>gptel</code> 和 <code>ellama</code> 的配置，使用本地运行的 <code>llama.cpp</code> 服务来提供兼容 OpenAI 的 API。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">gptel</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">gptel-expert-commands</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span>
</span></span><span class="line"><span class="cl">   <span class="nv">gptel-model</span>   <span class="ss">&#39;qwen3</span>
</span></span><span class="line"><span class="cl">   <span class="nv">gptel-backend</span> <span class="p">(</span><span class="nv">gptel-make-openai</span> <span class="s">&#34;llama.cpp&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="nb">:stream</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">                                    <span class="nb">:protocol</span> <span class="s">&#34;http&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="nb">:host</span> <span class="s">&#34;localhost:5810&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="nb">:models</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">qwen3</span> <span class="nv">qwen3-nothink</span> <span class="nv">gemma-3</span> <span class="nv">devstral</span><span class="p">))))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">ellama</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ensure</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span> <span class="p">(</span><span class="s">&#34;C-c l&#34;</span> <span class="o">.</span> <span class="nv">ellama-transient-main-menu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-ctrl-c-ctrl-c-final</span> <span class="o">.</span> <span class="nv">ellama-chat-send-last-message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">ellama-sessions-directory</span> <span class="s">&#34;~/.config/emacs/.local/cache/ellama-sessions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">; (setopt ellama-keymap-prefix &#34;C-c l&#34;)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-language</span> <span class="s">&#34;Chinese&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;llm-openai</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-openai-compatible</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:url</span> <span class="s">&#34;http://localhost:5810/v1&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen3&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;snowflake&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-summarization-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-openai-compatible</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:url</span> <span class="s">&#34;http://localhost:5810/v1&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen3&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;snowflake&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-coding-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-openai-compatible</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:url</span> <span class="s">&#34;http://localhost:5810/v1&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;devstral&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;snowflake&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-naming-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-openai-compatible</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:url</span> <span class="s">&#34;http://localhost:5810/v1&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen3-nothink&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;snowflake&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-naming-scheme</span> <span class="ss">&#39;ellama-generate-name-by-llm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-translation-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-openai-compatible</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:url</span> <span class="s">&#34;http://localhost:5810/v1&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen3&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;snowflake&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-extraction-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-openai-compatible</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:url</span> <span class="s">&#34;http://localhost:5810/v1&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen3&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;snowflake&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-chat-display-action-function</span> <span class="nf">#&#39;</span><span class="nv">display-buffer-full-frame</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-instant-display-action-function</span> <span class="nf">#&#39;</span><span class="nv">display-buffer-at-bottom</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">ellama-context-header-line-global-mode</span> <span class="mi">+1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><p>以前使用的基于 <code>Ollama</code> 的配置已废弃。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">gptel</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">gptel-expert-commands</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span>
</span></span><span class="line"><span class="cl">   <span class="nv">gptel-model</span>   <span class="ss">&#39;qwen2.5:14b</span>
</span></span><span class="line"><span class="cl">   <span class="nv">gptel-backend</span> <span class="p">(</span><span class="nv">gptel-make-ollama</span> <span class="s">&#34;ollama&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">:host</span> <span class="s">&#34;localhost:11434&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">:stream</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">:models</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">qwen2.5:14b</span> <span class="nv">qwen2.5-coder:32b</span><span class="p">))))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">ellama</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ensure</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span> <span class="p">(</span><span class="s">&#34;C-c l&#34;</span> <span class="o">.</span> <span class="nv">ellama-transient-main-menu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-ctrl-c-ctrl-c-final</span> <span class="o">.</span> <span class="nv">ellama-chat-send-last-message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">ellama-sessions-directory</span> <span class="s">&#34;~/.config/emacs/.local/cache/ellama-sessions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">; (setopt ellama-keymap-prefix &#34;C-c l&#34;)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-language</span> <span class="s">&#34;Chinese&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;llm-ollama</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-ollama</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen2.5:14b&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;nomic-embed-text&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:default-chat-non-standard-params</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;num_ctx&#34;</span> <span class="o">.</span> <span class="mi">8192</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-summarization-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-ollama</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen2.5:14b&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;nomic-embed-text&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:default-chat-non-standard-params</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;num_ctx&#34;</span> <span class="o">.</span> <span class="mi">32768</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-coding-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-ollama</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen2.5-coder:32b&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;nomic-embed-text&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:default-chat-non-standard-params</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;num_ctx&#34;</span> <span class="o">.</span> <span class="mi">32768</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-naming-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-ollama</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen2.5:14b&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;nomic-embed-text&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:default-chat-non-standard-params</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;stop&#34;</span> <span class="o">.</span> <span class="p">(</span><span class="s">&#34;\n&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-naming-scheme</span> <span class="ss">&#39;ellama-generate-name-by-llm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-translation-provider</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">make-llm-ollama</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:chat-model</span> <span class="s">&#34;qwen2.5:14b&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:embedding-model</span> <span class="s">&#34;nomic-embed-text&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:default-chat-non-standard-params</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;num_ctx&#34;</span> <span class="o">.</span> <span class="mi">32768</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-extraction-provider</span> <span class="p">(</span><span class="nv">make-llm-ollama</span>
</span></span><span class="line"><span class="cl">                                      <span class="nb">:chat-model</span> <span class="s">&#34;qwen2.5-coder:14b&#34;</span>
</span></span><span class="line"><span class="cl">                                      <span class="nb">:embedding-model</span> <span class="s">&#34;nomic-embed-text&#34;</span>
</span></span><span class="line"><span class="cl">                                      <span class="nb">:default-chat-non-standard-params</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;num_ctx&#34;</span> <span class="o">.</span> <span class="mi">32768</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-chat-display-action-function</span> <span class="nf">#&#39;</span><span class="nv">display-buffer-full-frame</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setopt</span> <span class="nv">ellama-instant-display-action-function</span> <span class="nf">#&#39;</span><span class="nv">display-buffer-at-bottom</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">ellama-context-header-line-global-mode</span> <span class="mi">+1</span><span class="p">))</span>
</span></span></code></pre></div><h2 id="幻灯片">幻灯片</h2>
<p><code>dslide</code> 基本配置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">dslide</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:hook</span>
</span></span><span class="line"><span class="cl">  <span class="p">((</span><span class="nv">dslide-start</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-fold-hide-block-all</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">x-stretch-cursor</span> <span class="mi">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">redraw-display</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">blink-cursor-mode</span> <span class="mi">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">cursor-type</span> <span class="ss">&#39;bar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;;(org-display-inline-images)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;;(hl-line-mode -1)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">text-scale-increase</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">read-only-mode</span> <span class="mi">1</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nv">dslide-stop</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">blink-cursor-mode</span> <span class="mi">+1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">x-stretch-cursor</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">cursor-type</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">text-scale-increase</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;;(hl-line-mode 1)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">read-only-mode</span> <span class="mi">-1</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">dslide-margin-content</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">dslide-animation-duration</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">dslide-margin-title-above</span> <span class="mf">0.3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">dslide-margin-title-below</span> <span class="mf">0.3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">dslide-header-email</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">dslide-header-date</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;&lt;f8&gt;&#34;</span><span class="p">)</span> <span class="nf">#&#39;</span><span class="nv">dslide-deck-start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">dslide-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;&lt;f9&gt;&#34;</span><span class="p">)</span> <span class="nf">#&#39;</span><span class="nv">dslide-deck-stop</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h2 id="其他配置">其他配置</h2>
<h3 id="popups">Popups</h3>
<p>设置一些工具窗口的弹出规则。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">vterm</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-popup-rule!</span> <span class="s">&#34;*doom:vterm-popup:main&#34;</span> <span class="nb">:size</span> <span class="mf">0.36</span> <span class="nb">:vslot</span> <span class="mi">-4</span> <span class="nb">:select</span> <span class="no">t</span> <span class="nb">:quit</span> <span class="no">nil</span> <span class="nb">:ttl</span> <span class="mi">0</span> <span class="nb">:side</span> <span class="ss">&#39;right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h3 id="smartparens">Smartparens</h3>
<p>因为我用 <code>lipsy</code> 所以其实 <code>smaertparens</code> 用的不多，不过作为保底，还是配了一下常用按键组合。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">map!</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">:after</span> <span class="nv">smartparens</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">:map</span> <span class="nv">smartparens-mode-map</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-M-f&#34;</span>       <span class="nf">#&#39;</span><span class="nv">sp-forward-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-M-b&#34;</span>       <span class="nf">#&#39;</span><span class="nv">sp-backward-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-M-u&#34;</span>       <span class="nf">#&#39;</span><span class="nv">sp-backward-up-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-M-d&#34;</span>       <span class="nf">#&#39;</span><span class="nv">sp-down-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-M-p&#34;</span>       <span class="nf">#&#39;</span><span class="nv">sp-backward-down-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-M-n&#34;</span>       <span class="nf">#&#39;</span><span class="nv">sp-up-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-)&#34;</span>         <span class="nf">#&#39;</span><span class="nv">sp-forward-slurp-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-}&#34;</span>         <span class="nf">#&#39;</span><span class="nv">sp-forward-barf-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-(&#34;</span>         <span class="nf">#&#39;</span><span class="nv">sp-backward-slurp-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-{&#34;</span>         <span class="nf">#&#39;</span><span class="nv">sp-backward-barf-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;C-M-s&#34;</span>       <span class="nf">#&#39;</span><span class="nv">sp-splice-sexp</span>
</span></span><span class="line"><span class="cl">   <span class="p">))</span>
</span></span><span class="line"><span class="cl"> <span class="p">)</span>
</span></span></code></pre></div><h3 id="python">Python</h3>
<p>几个小工具方便一些常用操作，包括用 <code>black</code> 格式化源代码。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">python</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:preface</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">+python-make-fstring</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Change string to fstring&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">3</span> <span class="p">(</span><span class="nv">syntax-ppss</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">p</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">8</span> <span class="p">(</span><span class="nv">syntax-ppss</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;f&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">forward-char</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">+python-format-buffer</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Format python buffer with black&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">python-black-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">python-mode-map</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;C-c x s&#34;</span> <span class="nf">#&#39;</span><span class="nv">+python-make-fstring</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;C-c x f&#34;</span> <span class="nf">#&#39;</span><span class="nv">+python-format-buffer</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="clojure">Clojure</h3>
<p>CIDER 是 Clojure 的 <em>REPL</em> ，缺省会作为一个 <em>popup</em> 显示在窗口下方，但一般来说习惯于左右分屏，所以需要修改；后面试 CIDER 的几个设置，一个可以在切换 <em>namespace</em> 的时候自动加载对应代码，另一个指定 <code>=cider-jack-in</code> 时使用 <code>deps.edn</code> 中哪个配置 <em>alias</em> 。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">cider</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-popup-rules!</span>
</span></span><span class="line"><span class="cl">    <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;^\\*cider-repl&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nb">:side</span> <span class="nv">right</span>
</span></span><span class="line"><span class="cl">       <span class="nb">:width</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">       <span class="nb">:quit</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">       <span class="nb">:ttl</span> <span class="no">nil</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">cider-repl-require-ns-on-set</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">cider-clojure-cli-aliases</span> <span class="s">&#34;:cider&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h3 id="prolog">Prolog</h3>
<p>这个语言比较小众，所以需要设置一下缺省的文件后缀，自动对应 <em>major-mode</em> ，一般来说后缀用 <code>pl</code> 和 <code>pro</code> 都可以，前者 <code>Perl</code> 语言会用，所以我们用后一个：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">auto-mode-alist</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">append</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;\\.pro&#34;</span> <span class="o">.</span> <span class="nv">prolog-mode</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="nv">auto-mode-alist</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="web">Web</h3>
<p><code>web-mode</code> 的 <em>auto indentation</em> 经常有奇怪的行为，还是关了好。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">web-mode-enable-auto-indentation</span> <span class="no">nil</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="epub">EPUB</h3>
<p>将 <code>.epub</code> 文件与 <code>nov.el</code> 绑定。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">nov</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;auto-mode-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;\\.epub\\&#39;&#34;</span> <span class="o">.</span> <span class="nv">nov-mode</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="keycast">keycast</h3>
<p>对 <code>doom-modeline</code> 需要做一些 <em>tweak</em> 才能用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">keycast</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:commands</span> <span class="nv">keycast-mode</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">define-minor-mode</span> <span class="nv">keycast-mode</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Show current command and its key binding in the mode line.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:global</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">keycast-mode</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;pre-command-hook</span> <span class="ss">&#39;keycast--update</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;global-mode-string</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;&#34;</span> <span class="nv">keycast-mode-line</span> <span class="s">&#34; &#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;pre-command-hook</span> <span class="ss">&#39;keycast--update</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">global-mode-string</span> <span class="p">(</span><span class="nv">remove</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;&#34;</span> <span class="nv">keycast-mode-line</span> <span class="s">&#34; &#34;</span><span class="p">)</span> <span class="nv">global-mode-string</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">custom-set-faces!</span>
</span></span><span class="line"><span class="cl">    <span class="o">&#39;</span><span class="p">(</span><span class="nv">keycast-command</span> <span class="nb">:inherit</span> <span class="nv">doom-modeline-debug</span> <span class="nb">:height</span> <span class="mf">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">&#39;</span><span class="p">(</span><span class="nv">keycast-key</span> <span class="nb">:inherit</span> <span class="nv">custom-modified</span> <span class="nb">:height</span> <span class="mf">1.1</span> <span class="nb">:weight</span> <span class="nv">bold</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="xkcd">xkcd</h3>
<p>干活累了看看漫画，不亦乐乎！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">xkcd</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">xkcd-get</span> <span class="nv">xkcd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">xkcd-cache-dir</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;xkcd/&#34;</span> <span class="nv">doom-cache-dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">xkcd-cache-latest</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;xkcd/latest&#34;</span> <span class="nv">doom-cache-dir</span><span class="p">)))</span>
</span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Literate Config：这个很酷的想法来源于 Donald Knuth 老爷子40年前提出的 <em>Literate Programming</em> ，就是把文字和程序写在同一文档里，用两个程序来处理这个文档，一个叫 <em>tangle</em> ，可以把里面所有代码提取出来组成一个可以运行的程序，另一个叫 <em>weave</em> ，可以将文档整体导出成各种可读格式供人阅读。关于这个优雅想法的更深入讨论，可以读读<a href="https://leanpub.com/lit-config/read">这本书</a>。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

</article>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"
    integrity="sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.js"
    integrity="sha384-Qsn9KnoKISj6dI8g7p1HBlNpVx0I8p1SvlwOldgi3IorMle61nQy4zEahWYtljaz"
    crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false }
            ]
        });
    });
</script>


<section class="post-nav">
    <ul>
        <li>
        
            <a href="/posts/emacs-reloaded/"><i class="fa fa-chevron-circle-left"></i> Emacs Reloaded</a>
        
        </li>
        <li>
        
            <a href="/posts/bridge-17/">自然叫牌法和防守系统（十七队） <i class="fa fa-chevron-circle-right"></i> </a>
        
        </li>
    </ul>
</section>
  
    
    
  





</main>
    <footer>
        <ul>
            <li>
                <h6>Copyright © 2024 - Neo Lee | 
                    Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
                    <a href="/index.xml">Subscribe </a></h6>
            </li>
            
            
        </ul>
    </footer>
</div>
<script src="/js/scripts.js"></script>

  


</body>

</html>

